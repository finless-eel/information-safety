## 一、用户指南

本指南面向工具使用者，详细说明工具的功能模块、操作步骤及注意事项，帮助快速完成加密、解密及相关实验操作。

### 1. 工具概述

S-AES 加密解密工具是基于简化版 AES（Simplified AES）算法开发的图形化工具，支持基础加解密、字符串处理、双重 / 三重加密、CBC 工作模式及中间相遇攻击实验，适用于密码学教学演示和算法验证。

工具通过 Tkinter 实现 GUI 界面，分为 5 个功能标签页，各模块独立运行，支持十六进制数据和 ASCII 字符串的加密解密操作。

### 2. 功能模块操作说明

#### 2.1 基本加解密（标签页 1）

**功能**：对 16 位十六进制明文 / 密文进行单次 S-AES 加解密，验证基础算法流程。

**操作步骤**：

1. 输入参数：
   - “16 位明文 (十六进制)”：输入 4 位十六进制数（如`0000`、`A1B2`，范围 0~FFFF）。
   - “16 位密钥 (十六进制)”：输入 4 位十六进制密钥（范围 0~FFFF）。
2. 执行操作：
   - 点击「加密」：将明文按输入密钥加密，结果以 4 位十六进制显示在 “结果” 栏。
   - 点击「解密」：将输入的 “明文” 视为密文，按密钥解密，结果显示在 “结果” 栏。
3. 示例：明文`0000`、密钥`0000`，加密结果为`9A9A`。

#### 2.2 字符串处理（标签页 2）

**功能**：对 ASCII 字符串进行批量 S-AES 加解密（自动将字符串拆分为 16 位块处理）。

**操作步骤**：

1. 输入参数：
   - “输入字符串”：输入任意 ASCII 字符串（如`Hello, S-AES!`）。
   - “16 位密钥 (十六进制)”：输入 4 位十六进制密钥（如`A1B2`）。
2. 执行操作：
   - 点击「加密」：将字符串拆分为 16 位块（不足补 0），逐块加密后拼接为字符串，显示在 “结果” 文本框。
   - 点击「解密」：将输入的 “加密字符串” 拆分为块，逐块解密后拼接为原始字符串，显示在 “结果” 文本框。
3. 注意：加密后的字符串可能包含不可打印字符，解密时需确保输入的是加密后的原始块拼接结果。

#### 2.3 双重加密与攻击（标签页 3）

**功能**：实现 32 位密钥的双重 S-AES 加解密，并通过 “中间相遇攻击” 破解双重加密密钥。

**操作步骤**：

1. 双重加密 / 解密：
   - 输入参数：16 位明文 / 密文（4 位十六进制）、32 位密钥（8 位十六进制，如`00000000`）。
   - 点击「双重加密」：用密钥前 16 位（k1）加密明文，再用后 16 位（k2）二次加密，结果显示在 “结果” 栏。
   - 点击「双重解密」：用密钥后 16 位（k2）解密密文，再用前 16 位（k1）二次解密，结果显示在 “结果” 栏。
2. 中间相遇攻击：
   - 输入参数：已知的 “明文 - 密文对”（均为 4 位十六进制）。
   - 点击「中间相遇攻击」：工具自动构建正向映射表（k1→中间结果）和反向搜索（k2→中间结果），匹配后输出 32 位密钥（8 位十六进制），若未找到则显示 “未找到密钥”。
3. 注意：攻击耗时约 1~2 分钟（遍历 65536 个 k1 和 k2），期间界面可能暂时冻结。

#### 2.4 三重加密（标签页 4）

**功能**：用 48 位密钥（3 个 16 位子密钥）实现 “加密 - 解密 - 加密”（E-D-E）模式的三重 S-AES 加解密，提升安全性。

**操作步骤**：

1. 输入参数：
   - 16 位明文 / 密文（4 位十六进制）。
   - 48 位密钥（12 位十六进制，如`000000000000`，前 16 位 k1、中间 16 位 k2、后 16 位 k3）。
2. 执行操作：
   - 点击「三重加密」：按 “k1 加密→k2 解密→k3 加密” 流程处理明文，结果显示在 “结果” 栏。
   - 点击「三重解密」：按 “k3 解密→k2 加密→k1 解密” 流程处理密文，结果显示在 “结果” 栏。

#### 2.5 CBC 工作模式（标签页 5）

**功能**：实现 S-AES 的 CBC（Cipher Block Chaining）分组密码模式，支持密文篡改实验，演示分组链接的安全性。

**操作步骤**：

1. CBC 加密：
   - 输入参数：明文（任意 ASCII 字符串）、16 位密钥（4 位十六进制）、16 位 IV（初始向量，4 位十六进制，可点击「生成随机 IV」获取）。
   - 点击「CBC 加密」：按 CBC 模式加密（明文块与前一密文块异或后加密，首块与 IV 异或），加密后的密文块以 “逗号分隔的十六进制” 显示在 “密文块” 栏，使用的 IV 显示在 “使用的 IV” 栏。
2. CBC 解密：
   - 输入参数：密文块（复制加密后的逗号分隔字符串）、密钥、IV（需与加密时一致）。
   - 点击「CBC 解密」：按 CBC 模式解密，结果显示在 “结果” 文本框。
3. 密文篡改实验：
   - 输入参数：加密后的密文块、“篡改密文索引”（需篡改的块序号，从 0 开始）、“新值”（篡改后的 4 位十六进制值）。
   - 点击「篡改密文并解密」：篡改指定位置的密文块后解密，结果显示篡改对明文的影响（通常导致当前块和下一块明文错乱）。

### 3. 常见问题与注意事项

1. 输入格式错误：所有十六进制输入需符合长度要求（如 16 位数据为 4 位十六进制），否则弹出 “错误” 提示，需重新输入。
2. 字符串解密乱码：若解密结果乱码，可能是密钥错误、密文被修改，或加密后的字符串被手动编辑（不可打印字符丢失）。
3. 中间相遇攻击失败：需确保输入的 “明文 - 密文对” 确实由双重加密生成，否则可能无法匹配密钥。
4. 界面响应缓慢：中间相遇攻击过程中，因遍历大量密钥对，界面可能暂时无响应，需等待攻击完成。

## 二、开发手册（接口文档）

本手册面向开发者，详细说明工具的核心组件封装、函数接口及调用示例，支持基于现有代码的二次开发（如扩展新工作模式、集成其他算法）。

### 1. 核心组件模块划分

工具代码按功能划分为 4 个核心模块，各模块函数独立封装，可单独调用：

| 模块名称       | 核心功能                          | 关键函数示例                     |
| -------------- | --------------------------------- | -------------------------------- |
| S-AES 基础操作 | 实现 S-AES 的核心变换和加解密流程 | `encrypt_block`、`decrypt_block` |
| 扩展加密模式   | 双重 / 三重加密、CBC 模式         | `double_encrypt`、`cbc_encrypt`  |
| 密码攻击模块   | 中间相遇攻击                      | `meet_in_the_middle`             |
| 数据转换工具   | 字符串与 16 位块的相互转换        | `str_to_blocks`、`blocks_to_str` |

### 2. 核心函数接口说明

#### 2.1 S-AES 基础操作模块

该模块实现 S-AES 算法的核心变换（半字节替换、行移位、列混淆、轮密钥加）及单块加解密，是所有扩展功能的基础。

##### 2.1.1 `encrypt_block(plaintext_block, key)`

- **功能**：对 16 位明文块进行单次 S-AES 加密。

- 参数：

  - `plaintext_block`：int，16 位明文块（范围 0~0xFFFF）。
  - `key`：int，16 位加密密钥（范围 0~0xFFFF）。

- **返回值**：int，16 位密文块（范围 0~0xFFFF）。

- 调用示例：

  ```python
  plaintext = 0x0000  # 十六进制0000
  key = 0x0000        # 十六进制0000
  ciphertext = encrypt_block(plaintext, key)
  print(hex(ciphertext))  # 输出：0x9a9a
  ```

  

##### 2.1.2 `decrypt_block(ciphertext_block, key)`

- **功能**：对 16 位密文块进行单次 S-AES 解密。

- 参数：

  - `ciphertext_block`：int，16 位密文块（范围 0~0xFFFF）。
  - `key`：int，16 位解密密钥（范围 0~0xFFFF，需与加密密钥一致）。

- **返回值**：int，16 位明文块（范围 0~0xFFFF）。

- 调用示例：

  ```python
  ciphertext = 0x9A9A
  key = 0x0000
  plaintext = decrypt_block(ciphertext, key)
  print(hex(plaintext))  # 输出：0x0
  ```

  

##### 2.1.3 核心变换函数（内部调用，可扩展）

- `sub_nibbles(state, inverse=False)`：半字节替换，`inverse=True`时使用逆 S 盒。
- `shift_rows(state)`：行移位变换（固定交换第 2、3 个半字节）。
- `mix_columns(state, inverse=False)`：列混淆，`inverse=True`时使用逆混淆矩阵。
- `add_round_key(state, round_key)`：轮密钥加（状态与轮密钥按位异或）。
- `key_expansion(key)`：密钥扩展，将 16 位原始密钥生成 3 个 16 位轮密钥（返回列表）。

#### 2.2 扩展加密模式模块

该模块基于基础 S-AES，实现更复杂的加密模式，提升安全性或适配不同场景。

##### 2.2.1 双重加密 / 解密

- ```
  double_encrypt(plaintext_block, key_32bit)
  ```

  - 功能：用 32 位密钥（k1+k2）对明文块进行两次 S-AES 加密。
  - 参数：`plaintext_block`（16 位明文）、`key_32bit`（32 位密钥，范围 0~0xFFFFFFFF）。
  - 返回：16 位密文块。

- ```
  double_decrypt(ciphertext_block, key_32bit)
  ```

  - 功能：用 32 位密钥（k1+k2）对密文块进行两次 S-AES 解密（先 k2 解密，再 k1 解密）。
  - 参数：`ciphertext_block`（16 位密文）、`key_32bit`（32 位密钥）。
  - 返回：16 位明文块。

##### 2.2.2 三重加密 / 解密

- ```
  triple_encrypt(plaintext_block, key_48bit)
  ```

  - 功能：用 48 位密钥（k1+k2+k3）按 “E-D-E” 模式加密（k1 加密→k2 解密→k3 加密）。
  - 参数：`plaintext_block`（16 位明文）、`key_48bit`（48 位密钥，范围 0~0xFFFFFFFFFFFF）。
  - 返回：16 位密文块。

- ```
  triple_decrypt(ciphertext_block, key_48bit)
  ```

  - 功能：用 48 位密钥按 “D-E-D” 模式解密（k3 解密→k2 加密→k1 解密）。
  - 参数：`ciphertext_block`（16 位密文）、`key_48bit`（48 位密钥）。
  - 返回：16 位明文块。

##### 2.2.3 CBC 工作模式

- ```
  cbc_encrypt(plaintext_str, key_16bit, iv_16bit)
  ```

  - 功能：对 ASCII 字符串进行 CBC 模式加密。
  - 参数：`plaintext_str`（待加密字符串）、`key_16bit`（16 位密钥）、`iv_16bit`（16 位初始向量）。
  - 返回：tuple，(密文块列表 [int]，使用的 IV [int])。

- ```
  cbc_decrypt(ciphertext_blocks, key_16bit, iv_16bit)
  ```

  - 功能：对 CBC 模式加密的密文块列表解密。
  - 参数：`ciphertext_blocks`（密文块列表 [int]）、`key_16bit`（16 位密钥）、`iv_16bit`（16 位 IV，需与加密一致）。
  - 返回：str，解密后的 ASCII 字符串。

#### 2.3 密码攻击模块

##### `meet_in_the_middle(plaintext_block, ciphertext_block)`

- **功能**：通过 “中间相遇攻击” 破解双重加密的 32 位密钥，需已知 1 对 “明文 - 密文块”。

- 参数：

  - `plaintext_block`：int，16 位明文块（攻击用已知明文）。
  - `ciphertext_block`：int，16 位密文块（对应已知明文的双重加密结果）。

- **返回值**：int/None，破解成功返回 32 位密钥（0~0xFFFFFFFF），失败返回 None。

- 调用示例

  ```python
  plaintext = 0x0000
  key_32bit = 0x12345678  # 待破解的32位密钥
  ciphertext = double_encrypt(plaintext, key_32bit)
  cracked_key = meet_in_the_middle(plaintext, ciphertext)
  print(hex(cracked_key))  # 输出：0x12345678（破解成功）
  ```

  

#### 2.4 数据转换工具模块

##### `str_to_blocks(input_str)`

- **功能**：将 ASCII 字符串转换为 16 位块列表（每 2 个字符组成 1 个块，不足补 0）。
- **参数**：`input_str`：str，待转换的 ASCII 字符串。
- **返回值**：list [int]，16 位块列表（每个元素范围 0~0xFFFF）。

##### `blocks_to_str(block_list)`

- **功能**：将 16 位块列表转换为 ASCII 字符串（忽略补位的 0 字符）。
- **参数**：`block_list`：list [int]，16 位块列表。
- **返回值**：str，转换后的 ASCII 字符串。

### 3. 二次开发建议

1. 扩展新工作模式：可参考 CBC 模式的实现，新增 ECB、CFB 等模式（需实现对应模式的块链接逻辑）。
2. 优化攻击性能：中间相遇攻击可通过多线程优化遍历速度，需注意 Tkinter 界面的线程安全（建议用`threading`模块并通过`after`方法更新 UI）。
3. 增加数据格式支持：当前仅支持十六进制和 ASCII，可扩展 Base64 编码（需新增`str_to_base64`、`base64_to_str`函数）。
4. 核心算法修改：若需调整 S-AES 参数（如 S 盒、轮常量），可直接修改代码开头的`S_BOX`、`ROUND_CONSTANTS`等全局变量，无需改动核心函数逻辑。